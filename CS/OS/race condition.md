# 동기화 Synchronization

- 사전적 의미: 작업들 사이의 수행 시기를 맞추는 것
- 실행 순서 제어: 프로세스를 `올바른 순서대로` 실행하기
- 상호 배제: `동시에 접근해서는 안 되는 자원`에 `하나의 프로세스만` 접근하게 하기

1. 실행 순서 제어를 위한 동기화
    - 동시에 실행되는 프로세스를 올바른 순서대로 실행하는 것
    - ex) Reader 프로세스(Book.txt에 저장된 값을 읽어 옴), Writer 프로세스(Book.txt에 값을 저장함)
    - Reader 프로세스는 ‘Book.txt에 값이 존재한다’는 조건이 만족되어야하만 실행이 가능하기 때문에
    **Writer 프로세스 실행이 끝나야 Reader 프로세스를 실행할 수 있다.**
2. 상호 배제를 위한 동기화
    - 공유 불가능한 자원의 `동시 사용을 피함`
    - 계좌 현재 잔액 10만원, 프로세스 A(2만원 넣기), 프로세스 B(5만원 넣기)
        - 프로세스 A: 계좌의 잔액을 읽어 옴 → 읽어온 잔액에 2만원을 더함 → 더한 값을 저장함.
        - 프로세스 B: 계좌의 잔액을 읽어 옴 → 읽어온 잔액에 5만원을 더함 → 더한 값을 저장함.
    - 만약 A와 B가 동시에 실행된다면 ?

      - **동기화가 이뤄지지 않았을 때**
        
          <img width="825" alt="image" src="https://github.com/LeeDahee23/Study/assets/82389864/f278e6a7-3adc-4a5b-a563-42016508f8e5">


       - **동기화가 이뤄진 경우**
        
          <img width="829" alt="image" src="https://github.com/LeeDahee23/Study/assets/82389864/87bb1447-23e4-4158-90d8-102f9c92e805">

        

# 공유 자원과 임계 구역

### 공유 자원 Shared Resource

- 전역변수와 같이 `프로세스끼리 서로 이용 가능한 공동의 자원`
- ex) 전역 변수, 파일, 입출력장치, 보조기억장치 등

### 임계 구역 Critical Section

- 동시에 실행하면 문제가 발생하는 자원에 접근하는 코드 영역
- 두 개 이상의 프로세스가 임계 구역에 진입하고자 하면 둘 중 하나는 대기해야 함

<img width="559" alt="image" src="https://github.com/LeeDahee23/Study/assets/82389864/50aee141-802c-4aca-b67f-c0d7768a1e48">


# 레이스 컨디션 Race Condition

- 잘못된 실행으로 인해 여러 프로세스가 동시 다발적으로 `임계 구역의 코드를 실행하여 문제가 발생`하는 경우
- 데이터의 일관성이 깨짐
- 계좌 잔액 문제

### Race Condition이 발생하는 경우

1. 커널 작업을 수행하는 중 인터럽트가 발생하는 경우
    - `문제점`: 커널 모드에서 데이터를 로드하여 작업을 수행하다가 인터럽트가 발생하여 같은 데이터를 조작하는 경우 ⇒ `커널은 서로 다른 프로세스가 공유`하기 때문에
        - ex) 변수 a를 증가시키는 코드 실행 중, 인터럽트가 발생함
        - 인터럽트 처리 함수에는 해당 변수 a를 감소시키는 코드가 있음
        - ⇒ 변수의 결과 값에 문제가 발생
    - `해결법`: 커널모드에서 작업을 수행하는 동안 `인터럽트를 disable` 시켜 CPU 제어권을 가져가지 못하도록 함
2. 프로세스가 시스템 콜을 호출하여 커널 모드로 수행하는 도중 context switch가 발생하는 경우
    - `문제점`: 프로세스 1이 커널모드에서 데이터를 조작하는 도중, 시간이 초과되어 CPU 제어권이 프로세스2로 넘어가 같은 데이터를 조작하는 경우
    - `해결법`: 프로세스가 커널모드에서 작업을 하는 경우 시간이 초과되어도 CPU 제어권이 다른 프로세스에게 넘어가지 않도록 한다.
3. 멀티 프로세서 환경에서 여러 프로세스가 공유 메모리 내 커널 안 변수에 접근하는 경우
    - `문제점`: 멀티 프로세서 환경에서 `2개의 CPU가 동시에 커널 내부의 공유 데이터에 접근`하여 조작하는 경우
    - `해결법`: 커널 내부에 있는 각 공유 데이터에 `접근할 때마다, 그 데이터에 대한 lock/unlock`을 함 ⇒ 매 순간 그 데이터에 접근하는 프로세스는 1개

### Race Condition을 예방할 수 있는 방법

1. 세마포어(Semaphore)
2. 뮤텍스(Mutex)



# 참고

https://javairus.tistory.com/44

[도서] 혼자 공부하는 컴퓨터구조+운영체제 (강민철, 한빛미디어)
